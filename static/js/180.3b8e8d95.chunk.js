"use strict";(self.webpackChunkschedule_management_system=self.webpackChunkschedule_management_system||[]).push([[180],{615:(e,s,r)=>{r.d(s,{A:()=>v});var a=r(43),t=r(620),n=r(849),l=r(316);function c(e,s){const r=(0,n.q)(),a=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??r.weekStartsOn??r.locale?.options?.weekStartsOn??0,t=(0,l.a)(e,s?.in),c=t.getDay(),i=6+(c<a?-7:0)-(c-a);return t.setDate(t.getDate()+i),t.setHours(23,59,59,999),t}var i=r(653),o=r(563),d=r(440);function u(e,s,r){const a=(0,l.a)(e,r?.in);return isNaN(s)?(0,d.w)(r?.in||e,NaN):s?(a.setDate(a.getDate()+s),a):a}function h(e,s,r){return u(e,7*s,r)}var m=r(35),p=r(799),g=r(107),y=r(579);const v=function(e){let{id:s,scheduleType:r,refreshTrigger:n}=e;const[l,d]=(0,a.useState)([]),{isLoggedIn:u,teacherId:v,token:x}=(0,g.J)(),[j,N]=(0,a.useState)(null),[T,b]=(0,a.useState)(new Date,"Europe/Warsaw"),C=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],k=(0,a.useCallback)((async()=>{let e;switch(r){case p.u.TEACHER:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/${s}/room/all`;break;case p.u.ROOM:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/classes/${s}/id`;break;default:throw new Error("Invalid schedule type")}try{const s=await fetch(e);if(!s.ok)throw new Error(`Error fetching classes: ${s.statusText}`);const r=await s.json();d(r),N(null)}catch(a){console.error("Error fetching classes:",a),N("Failed to load class data. Please try again later.")}}),[s,r]);(0,a.useEffect)((()=>{k()}),[k,n]);const S=(()=>{const e=(0,t.k)(T,{weekStartsOn:1}),s=c(T,{weekStartsOn:1}),r=e=>"1.00:00:00"===e?"24:00:00":e,a=e=>(0,i.H)(`2000-01-01T${r(e)}`),n=(e=>{const s=new Date(2024,0,1),r=Math.floor((e-s)/864e5);return(Math.floor(r/7)+1)%2===0?"even":"odd"})(T),d=C.map((()=>[])),u=e=>0===e?6:e-1;return l.forEach((a=>{a.recurringClasses.forEach((t=>{const l=t.canceledDates.some((r=>{const a=(e=>{const[s,r,a]=e.split("/");return new Date(`${a}-${s}-${r}`).toISOString()})(r),t=(0,i.H)(a);return(0,o.v)(t,{start:e,end:s})}));(t.isEveryWeek||t.isEven&&"even"===n||!t.isEven&&"odd"===n)&&d[u(t.recurrenceDay)].push({...a,recurrenceStartTime:r(t.recurrenceStartTime),recurrenceEndTime:r(t.recurrenceEndTime),teacherId:a.teacherId,teacherName:a.teacherName,teacherTitle:a.teacherTitle,roomNumber:a.roomNumber,roomId:a.roomId,isEveryWeek:t.isEveryWeek,isEven:t.isEven,isCanceled:l,recurrenceDay:t.recurrenceDay,classType:"Recurring"})})),a.oneTimeClasses&&a.oneTimeClasses.length>0&&a.oneTimeClasses.forEach((t=>{const n=(e=>{const[s,r,a]=e.split("/");return new Date(`${a}-${s}-${r}`).toISOString()})(t.oneTimeClassFullDate),l=(0,i.H)(n);if(console.log(n),console.log(l),(0,o.v)(l,{start:e,end:s})){const e=u(l.getDay());d[e].push({...a,date:l,recurrenceStartTime:r(t.oneTimeClassStartTime),recurrenceEndTime:r(t.oneTimeClassEndTime),teacherId:a.teacherId,teacherName:a.teacherName,teacherTitle:a.teacherTitle,roomNumber:a.roomNumber,roomId:a.roomId,isCanceled:a.isCanceled,classType:"One-Time"})}}))})),d.forEach((e=>{e.sort(((e,s)=>a(e.recurrenceStartTime)-a(s.recurrenceStartTime)))})),console.log(l),console.log(d),d})(),w=e=>b((s=>h(s,e)));return(0,y.jsxs)("div",{className:"weekly-schedule-container",children:[j&&(0,y.jsx)("div",{className:"weekly-schedule-error-message",children:j}),(0,y.jsxs)("div",{className:"weekly-schedule-week-selector",children:[(0,y.jsx)("button",{className:"weekly-schedule-button",onClick:()=>w(-1),children:"Previous Week"}),(0,y.jsxs)("span",{className:"weekly-schedule-date-range",children:[(0,m.GP)((0,t.k)(T,{weekStartsOn:1}),"MMM d")," -"," ",(0,m.GP)(c(T,{weekStartsOn:1}),"MMM d")]}),(0,y.jsx)("button",{className:"weekly-schedule-button",onClick:()=>w(1),children:"Next Week"})]}),(0,y.jsx)("div",{className:"weekly-schedule-week",children:C.map(((e,s)=>(0,y.jsxs)("div",{className:"weekly-schedule-day-column",children:[(0,y.jsx)("h3",{className:"weekly-schedule-day-title",children:e}),S[s].length>0?S[s].map(((e,s)=>(0,y.jsxs)("div",{className:`weekly-schedule-class-card weekly-schedule-${e.classType.toLowerCase()}`,children:[(0,y.jsx)("h4",{className:"weekly-schedule-class-title",children:e.classTitle}),(0,y.jsx)("a",{href:`/classroom/${e.campusName}/${e.roomNumber}/${e.roomId}`,className:"classroom-number",children:e.roomNumber}),(0,y.jsxs)("p",{className:"weekly-schedule-class-time",children:[(0,m.GP)((0,i.H)(`2000-01-01T${e.recurrenceStartTime}`),"HH:mm")," -"," ",(0,m.GP)((0,i.H)(`2000-01-01T${e.recurrenceEndTime}`),"HH:mm")]}),e.isCanceled&&(0,y.jsx)("span",{className:"",children:"Cancelled"}),(0,y.jsxs)("a",{href:`/teacher/${e.teacherName}/${e.teacherTitle}/${e.teacherId}`,className:"weekly-schedule-class-teacher",children:[e.teacherTitle||"No title","   ",e.teacherName]}),(0,y.jsxs)("div",{className:"class-card-buttons",children:[u&&v===e.teacherId&&"One-Time"===e.classType&&(0,y.jsx)("button",{className:"cancel-meeting-button",onClick:()=>(async e=>{const{classId:s,classType:r,isCanceled:a}=e;let t="",n=null;try{"One-Time"===r&&(t=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/cancelOrRestoreClassOneTime/${s}?teacherId=${v}&teacherToken=${x}`,n=null);const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:n?JSON.stringify(n):null});if(!e.ok)throw new Error(`Failed to update class: ${e.statusText}`);if("successfully."!==(await e.json()).message)throw new Error("Unexpected response message");{const e=l.map((e=>e.classId===s?{...e,isCanceled:!a}:e));d(e),alert(`Class ${a?"restored":"canceled"} successfully.`)}}catch(c){console.error("Error updating class:",c),alert("An error occurred while updating the class. Please try again.")}})(e),children:e.isCanceled?"Restore Meeting":"Cancel Meeting"}),u&&v===e.teacherId&&(0,y.jsx)("button",{className:"delete-meeting-button",onClick:()=>(async e=>{try{if(!v||!x)return void alert("Authentication details are missing. Please log in again.");const s=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/deleteClass/${e.classId}?teacherId=${v}&teacherToken=${x}`,r=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!r.ok)throw new Error("Unexpected server response");if("Class and all related data deleted successfully."!==(await r.json()).message)throw new Error("Unexpected server response");{const s=l.filter((s=>s.classId!==e.classId));d(s),alert(`Class ${e.classTitle} has been deleted successfully`)}}catch(s){console.error("Error deleting class:",s),alert("An error occurred while deleting the class. Please try again.")}})(e),children:"Delete Meeting"})]})]},s))):(0,y.jsx)("p",{className:"weekly-schedule-no-classes",children:"No classes"})]},s)))})]})}},799:(e,s,r)=>{r.d(s,{u:()=>a});const a={TEACHER:"TEACHER",ROOM:"ROOM"}},180:(e,s,r)=>{r.r(s),r.d(s,{default:()=>o});var a=r(43),t=r(107),n=r(579);const l=e=>{let{onClassCreated:s}=e;const{isLoggedIn:r,teacherId:l,token:c}=(0,t.J)(),[i,o]=(0,a.useState)(""),[d,u]=(0,a.useState)(""),[h,m]=(0,a.useState)(""),[p,g]=(0,a.useState)(""),[y,v]=(0,a.useState)(!1),[x,j]=(0,a.useState)(""),[N,T]=(0,a.useState)({hours:0,minutes:0,seconds:0}),[b,C]=(0,a.useState)({hours:0,minutes:0,seconds:0}),[k,S]=(0,a.useState)(!1),[w,f]=(0,a.useState)(!1),[E,$]=(0,a.useState)(0),[I,O]=(0,a.useState)({hours:0,minutes:0,seconds:0}),[D,M]=(0,a.useState)({hours:0,minutes:0,seconds:0}),[F,R]=(0,a.useState)([]),[q]=(0,a.useState)(["MS"]);(0,a.useEffect)((()=>{(async()=>{try{const e=await fetch("https://backend-azure-sqlite-appservice.azurewebsites.net/Main/room/all"),s=await e.json();if(e.ok){const e=s.sort(((e,s)=>e.RoomNumber-s.RoomNumber));R(e)}else console.error("Failed to fetch classrooms:",s.message)}catch(e){console.error("Error fetching classrooms:",e)}})()}),[]);return(0,n.jsxs)("div",{className:"create-class-container",children:[(0,n.jsx)("h2",{children:"Create New Class"}),(0,n.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),!r||!l||!c)return void alert("User not logged in or missing credentials. Please log in again.");const a={roomNumber:i,title:d,description:h,campusName:p,isOneTimeClass:y,oneTimeClassFullDate:y?x:null,oneTimeClassStartTime:y?N:{hours:0,minutes:0,seconds:0},oneTimeClassEndTime:y?b:{hours:0,minutes:0,seconds:0},isEveryWeek:!y&&k,isEven:!y&&!k&&w,recurrenceDay:y?0:E,recurrenceStartTime:y?{hours:0,minutes:0,seconds:0}:I,recurrenceEndTime:y?{hours:0,minutes:0,seconds:0}:D};try{const e=await fetch(`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/createClass?teacherId=${l}&teacherToken=${c}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await e.json();e.ok?(alert("Class created successfully!"),s()):alert("Error creating class: "+r.message)}catch(t){console.error("Error:",t),alert("An error occurred while creating the class")}},className:"create-class-form",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"campusName",children:"Campus"}),(0,n.jsxs)("select",{id:"campusName",value:p,onChange:e=>g(e.target.value),required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select a campus"}),q.map((e=>(0,n.jsx)("option",{value:e,children:e},e)))]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"roomNumber",children:"Room Number"}),(0,n.jsxs)("select",{id:"roomNumber",value:i,onChange:e=>o(e.target.value),required:!0,children:[(0,n.jsx)("option",{value:"",children:"Select a room"}),F.map((e=>(0,n.jsx)("option",{value:e.RoomNumber,children:e.RoomNumber},e.RoomId)))]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"title",children:"Class Title"}),(0,n.jsx)("input",{type:"text",id:"title",value:d,onChange:e=>u(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"description",children:"Description"}),(0,n.jsx)("input",{type:"text",id:"description",value:h,onChange:e=>m(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"isOneTimeClass",children:"One-time Class"}),(0,n.jsx)("input",{type:"checkbox",id:"isOneTimeClass",checked:y,onChange:()=>v((e=>!e))})]}),y?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"oneTimeClassFullDate",children:"Class Date"}),(0,n.jsx)("input",{type:"date",id:"oneTimeClassFullDate",value:x,onChange:e=>j(e.target.value),required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Start Time"}),(0,n.jsx)("input",{type:"time",value:`${String(N.hours).padStart(2,"0")}:${String(N.minutes).padStart(2,"0")}`,onChange:e=>{const[s,r]=e.target.value.split(":");T({hours:Number(s),minutes:Number(r),seconds:0})},required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"End Time"}),(0,n.jsx)("input",{type:"time",value:`${String(b.hours).padStart(2,"0")}:${String(b.minutes).padStart(2,"0")}`,onChange:e=>{const[s,r]=e.target.value.split(":");C({hours:Number(s),minutes:Number(r),seconds:0})},required:!0})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"isEveryWeek",children:"Repeat Weekly"}),(0,n.jsx)("input",{type:"checkbox",id:"isEveryWeek",checked:k,onChange:()=>S((e=>!e))})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"recurrenceDay",children:"Recurrence Day"}),(0,n.jsxs)("select",{id:"recurrenceDay",value:E,onChange:e=>$(Number(e.target.value)),children:[(0,n.jsx)("option",{value:1,children:"Monday"}),(0,n.jsx)("option",{value:2,children:"Tuesday"}),(0,n.jsx)("option",{value:3,children:"Wednesday"}),(0,n.jsx)("option",{value:4,children:"Thursday"}),(0,n.jsx)("option",{value:5,children:"Friday"}),(0,n.jsx)("option",{value:6,children:"Saturday"}),(0,n.jsx)("option",{value:0,children:"Sunday"})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Start Time"}),(0,n.jsx)("input",{type:"time",value:`${String(I.hours).padStart(2,"0")}:${String(I.minutes).padStart(2,"0")}`,onChange:e=>{const[s,r]=e.target.value.split(":");O({hours:Number(s),minutes:Number(r),seconds:0})},required:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"End Time"}),(0,n.jsx)("input",{type:"time",value:`${String(D.hours).padStart(2,"0")}:${String(D.minutes).padStart(2,"0")}`,onChange:e=>{const[s,r]=e.target.value.split(":");M({hours:Number(s),minutes:Number(r),seconds:0})},required:!0})]}),!k&&(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"isEven",children:"Even Weeks"}),(0,n.jsx)("input",{type:"checkbox",id:"isEven",checked:w,onChange:()=>f((e=>!e))})]})]}),(0,n.jsx)("button",{type:"submit",children:"Create Class"})]})]})};var c=r(615),i=r(799);const o=function(){const{teacherId:e,isLoggedIn:s}=(0,t.J)(),[r,o]=(0,a.useState)(!1),d=()=>{o((e=>!e))};return(0,n.jsxs)("div",{className:"dashboard",onClassCreated:d,children:[s&&e?(0,n.jsx)(c.A,{id:e,scheduleType:i.u.TEACHER,refreshTrigger:r}):(0,n.jsx)("p",{className:"dashboard-no-schedule",children:"Please log in to view your schedule."}),(0,n.jsx)(l,{onClassCreated:d})]})}}}]);
//# sourceMappingURL=180.3b8e8d95.chunk.js.map