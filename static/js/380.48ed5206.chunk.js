"use strict";(self.webpackChunkschedule_management_system=self.webpackChunkschedule_management_system||[]).push([[380],{746:(e,s,a)=>{a.d(s,{A:()=>k});var r=a(43),t=a(475),c=a(620),l=a(849),n=a(316);function o(e,s){const a=(0,l.q)(),r=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,t=(0,n.a)(e,s?.in),c=t.getDay(),o=6+(c<r?-7:0)-(c-r);return t.setDate(t.getDate()+o),t.setHours(23,59,59,999),t}var i=a(653),d=a(563),m=a(981);function h(e,s,a){return(0,m.f)(e,7*s,a)}var u=a(865),p=a(799),g=a(107),y=a(498),w=a(579);const k=function(e){let{id:s,scheduleType:a,refreshTrigger:l,onClassCancelled:n}=e;const[m,k]=(0,r.useState)(!0),[N,f]=(0,r.useState)([]),{isLoggedIn:T,teacherId:x,token:j}=(0,g.J)(),[C,b]=(0,r.useState)(null),[v,E]=(0,r.useState)(new Date,"Europe/Warsaw"),$=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],S=(0,r.useCallback)((async()=>{let e;switch(a){case p.u.TEACHER:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/${s}/room/all`;break;case p.u.ROOM:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/classes/${s}/id`;break;default:throw new Error("Invalid schedule type")}try{k(!0);const s=await fetch(e);if(!s.ok)throw new Error(`Error fetching classes: ${s.statusText}`);const a=await s.json();f(a),b(null),k(!1)}catch(r){console.error("Error fetching classes:",r),b("Failed to load class data. Please try again later."),k(!1)}}),[s,a]);(0,r.useEffect)((()=>{S()}),[S,l]);const M=(()=>{const e=(0,c.k)(v,{weekStartsOn:1}),s=o(v,{weekStartsOn:1}),a=e=>"1.00:00:00"===e?"24:00:00":e,r=e=>(0,i.H)(`2000-01-01T${a(e)}`),t=(e=>{const s=new Date(2024,0,1),a=Math.floor((e-s)/864e5);return(Math.floor(a/7)+1)%2===0?"even":"odd"})(v),l=$.map((()=>[])),n=e=>0===e?6:e-1;return N.forEach((r=>{r.recurringClasses.forEach((c=>{const o=c.canceledDates.some((a=>{const r=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(a),t=(0,i.H)(r);return(0,d.v)(t,{start:e,end:s})}));(c.isEveryWeek||c.isEven&&"even"===t||!c.isEven&&"odd"===t)&&l[n(c.recurrenceDay)].push({...r,recurrenceStartTime:a(c.recurrenceStartTime),recurrenceEndTime:a(c.recurrenceEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isEveryWeek:c.isEveryWeek,isEven:c.isEven,isCanceled:o,recurrenceDay:c.recurrenceDay,classType:"Recurring"})})),r.oneTimeClasses&&r.oneTimeClasses.length>0&&r.oneTimeClasses.forEach((t=>{const c=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(t.oneTimeClassFullDate),o=(0,i.H)(c);if((0,d.v)(o,{start:e,end:s})){const e=n(o.getDay());l[e].push({...r,date:o,recurrenceStartTime:a(t.oneTimeClassStartTime),recurrenceEndTime:a(t.oneTimeClassEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isCanceled:r.isCanceled,classType:"One-Time"})}}))})),l.forEach((e=>{e.sort(((e,s)=>r(e.recurrenceStartTime)-r(s.recurrenceStartTime)))})),l})(),I=e=>E((s=>h(s,e))),D=async e=>{const{classId:s,classType:a,isCanceled:r,recurrenceDay:t}=e,c="https://backend-azure-sqlite-appservice.azurewebsites.net/Main";let l="",o=null;try{if("One-Time"===a)l=`${c}/cancelOrRestoreClassOneTime/${s}?teacherId=${x}&teacherToken=${j}`,o=null;else{if("Recurring"!==a)throw new Error("Unknown class type");{const e=(()=>{const e=new Date(v),s=e.getDay(),a=(0===t?7:t)-s;return e.setDate(e.getDate()+a),a<=0&&e.setDate(e.getDate()),e})();r?(l=`${c}/restoreRecurringClass/${s}?teacherId=${x}&teacherToken=${j}`,o=(0,u.GP)(e,"yyyy-MM-dd")):(l=`${c}/cancelRecurringClass/${s}?teacherId=${x}&teacherToken=${j}`,o=(0,u.GP)(e,"yyyy-MM-dd"))}}const e=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:o?JSON.stringify(o):null});if(!e.ok)throw new Error(`Failed to update class: ${e.statusText}`);if(!(await e.json()).message.includes("successfully"))throw new Error("Unexpected response message");alert(`Class ${r?"restored":"canceled"} successfully.`),n()}catch(i){console.error("Error updating class:",i),alert("An error occurred while updating the class. Please try again."),n()}};return m?(0,w.jsx)(y.A,{}):(0,w.jsxs)("div",{className:"weekly-schedule-container",children:[C&&(0,w.jsx)("div",{className:"weekly-schedule-error-message",children:C}),(0,w.jsxs)("div",{className:"weekly-schedule-week-selector",children:[(0,w.jsx)("button",{className:"weekly-schedule-button",onClick:()=>I(-1),children:"Previous Week"}),(0,w.jsxs)("span",{className:"weekly-schedule-date-range",children:[(0,u.GP)((0,c.k)(v,{weekStartsOn:1}),"MMM d")," -"," ",(0,u.GP)(o(v,{weekStartsOn:1}),"MMM d")]}),(0,w.jsx)("button",{className:"weekly-schedule-button",onClick:()=>I(1),children:"Next Week"})]}),(0,w.jsx)("div",{className:"weekly-schedule-week",children:$.map(((e,s)=>(0,w.jsxs)("div",{className:"weekly-schedule-day-column",children:[(0,w.jsx)("h3",{className:"weekly-schedule-day-title",children:e}),M[s].length>0?M[s].map(((e,s)=>(0,w.jsxs)("div",{className:`weekly-schedule-class-card weekly-schedule-${e.classType.toLowerCase()}`,children:[(0,w.jsx)("h4",{className:"weekly-schedule-class-title",children:e.classTitle}),(0,w.jsx)(t.N_,{to:`/classroom/${e.campusName}/${e.roomNumber}/${e.roomId}`,className:"classroom-number",children:e.roomNumber}),(0,w.jsxs)("p",{className:"weekly-schedule-class-time",children:[(0,u.GP)((0,i.H)(`2000-01-01T${e.recurrenceStartTime}`),"HH:mm")," -"," ",(0,u.GP)((0,i.H)(`2000-01-01T${e.recurrenceEndTime}`),"HH:mm")]}),e.isCanceled&&(0,w.jsx)("span",{className:"",children:"Cancelled"}),(0,w.jsx)(t.N_,{to:`/teacher/${e.teacherName}/${e.teacherTitle}/${e.teacherId}`,className:"weekly-schedule-class-teacher",children:e.teacherName}),(0,w.jsxs)("div",{className:"class-card-buttons",children:[T&&x===e.teacherId&&(0,w.jsx)("button",{className:"cancel-meeting-button",onClick:()=>D(e),children:e.isCanceled?"Restore Meeting":"Cancel Meeting"}),T&&x===e.teacherId&&(0,w.jsx)("button",{className:"delete-meeting-button",onClick:()=>(async e=>{try{if(!x||!j)return void alert("Authentication details are missing. Please log in again.");const s=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/deleteClass/${e.classId}?teacherId=${x}&teacherToken=${j}`,a=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Unexpected server response");if("Class and all related data deleted successfully."!==(await a.json()).message)throw new Error("Unexpected server response");{const s=N.filter((s=>s.classId!==e.classId));f(s),alert(`Class ${e.classTitle} has been deleted successfully`)}}catch(s){console.error("Error deleting class:",s),alert("An error occurred while deleting the class. Please try again.")}})(e),children:"Delete Meeting"})]})]},s))):(0,w.jsx)("p",{className:"weekly-schedule-no-classes",children:"No classes"})]},s)))})]})}},799:(e,s,a)=>{a.d(s,{u:()=>r});const r={TEACHER:"TEACHER",ROOM:"ROOM"}},622:(e,s,a)=>{a.r(s),a.d(s,{default:()=>i});var r=a(43),t=a(216),c=a(746),l=a(799);const n={MS:{fullName:"Wydzia\u0142 Matematyki Stosowanej",mapsEmbedSrc:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2549.043926603353!2d18.677463113142103!3d50.29110789870408!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47113101aa29eacb%3A0xb264c95270614eda!2sPolitechnika%20%C5%9Al%C4%85ska%2C%20Wydzia%C5%82%20Matematyki%20Stosowanej!5e0!3m2!1sen!2spl!4v1733085254800!5m2!1sen!2spl",imageSrc:a.p+"static/media/wydzial-rms-slide.f401748cc346648833d1.jpg"}};var o=a(579);const i=function(){const{campus:e,number:s,id:i}=(0,t.g)(),d=n[e],[m,h]=(0,r.useState)(!1);return(0,o.jsxs)("div",{className:"classroom-page-container",children:[(0,o.jsxs)("div",{className:"classroom-page-header",children:[(0,o.jsx)("h2",{className:"classroom-page-title",children:d.fullName}),(0,o.jsx)("div",{className:"classroom-page-info",children:(0,o.jsx)("h1",{className:"classroom-page-classroom-number",children:s})})]}),(0,o.jsxs)("div",{className:"classroom-page-schedule-section",children:[(0,o.jsx)("h2",{className:"classroom-page-schedule-title",children:"Classroom Weekly Schedule"}),(0,o.jsx)(c.A,{id:i,scheduleType:l.u.ROOM,refreshTrigger:m,onClassCancelled:()=>{h((e=>!e))}})]}),(0,o.jsxs)("div",{className:"classroom-page-campus-info-section",children:[(0,o.jsxs)("div",{className:"classroom-page-google-maps",children:[(0,o.jsx)("h3",{className:"classroom-page-google-maps-title",children:"Campus Location"}),(0,o.jsx)("iframe",{src:d.mapsEmbedSrc,width:"600",height:"450",style:{border:"0"},allowFullScreen:"",loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:`Google Maps embed showing the location of ${e}`})]}),(0,o.jsxs)("div",{className:"classroom-page-campus-image",children:[(0,o.jsx)("h3",{className:"classroom-page-campus-image-title",children:"Campus Image"}),(0,o.jsx)("img",{src:d.imageSrc,alt:`${e} campus`})]})]}),(0,o.jsxs)("div",{className:"classroom-page-maphelper-section",children:[(0,o.jsx)("h3",{className:"classroom-page-maphelper-title",children:"Get MapHelper App"}),(0,o.jsx)("a",{href:"https://arsenimokhau.github.io/Map-Helper/",target:"_blank",rel:"noopener noreferrer",children:(0,o.jsx)("img",{src:a(402),alt:"QR Code for MapHelper",className:"classroom-page-maphelper-qr",style:{width:"200px",height:"200px"}})}),(0,o.jsx)("p",{children:"Scan the QR code or click it to open the MapHelper application."})]})]})}},402:(e,s,a)=>{e.exports=a.p+"static/media/qr.a3e5c59d148691b73a45.png"},981:(e,s,a)=>{a.d(s,{f:()=>c});var r=a(440),t=a(316);function c(e,s,a){const c=(0,t.a)(e,a?.in);return isNaN(s)?(0,r.w)(a?.in||e,NaN):s?(c.setDate(c.getDate()+s),c):c}}}]);
//# sourceMappingURL=380.48ed5206.chunk.js.map