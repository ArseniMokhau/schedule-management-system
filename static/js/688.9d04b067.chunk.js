"use strict";(self.webpackChunkschedule_management_system=self.webpackChunkschedule_management_system||[]).push([[688],{688:(e,a,s)=>{s.r(a),s.d(a,{default:()=>N});var t=s(43),r=s(589),c=s(35),l=s(653),n=s(563),o=s(944),i=s(582),d=s(579);const u=function(){var e;const[a,s]=(0,t.useState)(null),[u,h]=(0,t.useState)(null),[m,N]=(0,t.useState)([]),[f,v]=(0,t.useState)(null),[T,y]=(0,t.useState)(new Date),[p,b]=(0,t.useState)(new Date),[j,x]=(0,t.useState)([]),g=(0,t.useCallback)((async()=>{try{var e;const a=await fetch("https://backend-azure-sqlite-appservice.azurewebsites.net/Main/room/all");if(!a.ok)throw new Error(`Error fetching rooms: ${a.statusText}`);const t=(await a.json()).reduce(((e,a)=>{const s=parseInt(a.RoomNumber.charAt(0),10);return e[s]||(e[s]=[]),e[s].push({number:a.RoomNumber,status:"empty",roomId:a.RoomId,campusName:"MS"}),e}),{}),r={name:"MS",fullName:"Wydzia\u0142 Matematyki Stosowanej",floors:Object.keys(t).map((e=>({floorNumber:parseInt(e,10),classrooms:t[e]}))).sort(((e,a)=>e.floorNumber-a.floorNumber))};s(r),h(r.floors[0]),N((null===(e=r.floors[0])||void 0===e?void 0:e.classrooms)||[]),v(null)}catch(a){console.error("Error fetching room data:",a),v("Failed to fetch room data. Please try again later.")}}),[]),w=(0,t.useCallback)((async()=>{try{const e=(0,r.L_)(T,"Europe/Warsaw"),a=e.getDay()%7,s=await fetch(`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/classes/day/dayOfWeek?dayOfWeek=${a}`);if(!s.ok)throw new Error(`Error fetching recurring classes: ${s.statusText}`);const t=await s.json(),l=await fetch(`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/classes/date/OneTimeClass?date=${(0,c.GP)(e,"yyyy-MM-dd")}`);if(!l.ok)throw new Error(`Error fetching one-time classes: ${l.statusText}`);const n=await l.json(),o=[...t,...n].map((e=>("1.00:00:00"===e.recurrenceEndTime&&(e.recurrenceEndTime="24:00:00"),e)));x(o),v(null)}catch(e){console.error("Error fetching class data:",e),v("Failed to fetch class data. Please try again later.")}}),[T]),k=(0,t.useCallback)((()=>{const e={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6},a=(0,r.L_)(new Date(T.setHours(p.getHours(),p.getMinutes())),"Europe/Warsaw"),s=a.toISOString().split("T")[0],t=a.getDay()%7,o=[],i=(e=>{const a=new Date(2024,0,1),s=Math.floor((e-a)/864e5);return(Math.floor(s/7)+1)%2===0?"even":"odd"})(a);j.forEach((r=>{const{roomNumber:d,recurrenceStartTime:u,recurrenceEndTime:h,recurrenceDay:m,teacherName:N,teacherId:f,teacherTitle:v,classTitle:T,canceledDates:y,isEveryWeek:p,isEven:b,oneTimeClassFullDate:j,oneTimeClassStartTime:x,oneTimeClassEndTime:g,isCanceled:w}=r;if(j){if(j.includes(s)){const e=(0,l.H)(`${s}T${x[0]}`),t=(0,l.H)(`${s}T${g[0]}`);"False"===w?(0,n.v)(a,{start:e,end:t})&&o.push({roomNumber:d,teacherName:N,teacherId:f,teacherTitle:v,classTitle:T,status:"taken",canceledNotice:null}):(0,n.v)(a,{start:e,end:t})&&o.push({roomNumber:d,teacherName:N,teacherId:f,teacherTitle:v,classTitle:T,status:"canceled",canceledNotice:"Class is canceled"})}}else{if(e[m]===t){const e=(0,l.H)(`${s}T${u}`),t=(0,l.H)(`${s}T${h}`);if((0,n.v)(a,{start:e,end:t}))if("True"===p){const e=y.includes((0,c.GP)(a,"dd/MM/yyyy"));o.push({roomNumber:d,teacherName:N,teacherId:f,teacherTitle:v,classTitle:T,status:e?"canceled":"taken",canceledNotice:e?"Class is canceled today":null})}else if(i===("True"===b?"even":"odd")){const e=y.includes((0,c.GP)(a,"dd/MM/yyyy"));o.push({roomNumber:d,teacherName:N,teacherId:f,teacherTitle:v,classTitle:T,status:e?"canceled":"taken",canceledNotice:e?"Class is canceled today":null})}else o.push({roomNumber:d,teacherName:N,teacherId:f,teacherTitle:v,classTitle:T,status:"empty",canceledNotice:null})}}}));const d=u.classrooms.map((e=>{const a=o.find((a=>a.roomNumber===e.number));return{...e,status:a?a.status:"empty",teacherName:(null===a||void 0===a?void 0:a.teacherName)||null,teacherId:(null===a||void 0===a?void 0:a.teacherId)||null,teacherTitle:(null===a||void 0===a?void 0:a.teacherTitle)||null,classTitle:(null===a||void 0===a?void 0:a.classTitle)||null,canceledNotice:(null===a||void 0===a?void 0:a.canceledNotice)||null}}));N(d)}),[u,j,T,p]);return(0,t.useEffect)((()=>{g()}),[g]),(0,t.useEffect)((()=>{w()}),[w,T]),(0,t.useEffect)((()=>{u&&j.length&&k()}),[u,k,j.length,p]),(0,d.jsxs)("div",{className:"map-container",children:[(0,d.jsx)("h2",{children:null===a||void 0===a?void 0:a.fullName}),f&&(0,d.jsx)("div",{className:"error-message",children:f}),(0,d.jsxs)("div",{className:"date-time-selector",children:[(0,d.jsxs)("label",{children:["Select Date:",(0,d.jsx)("input",{type:"date",onChange:e=>{const a=new Date(e.target.value);a.setHours(p.getHours(),p.getMinutes()),y(a)},value:(0,c.GP)(T,"yyyy-MM-dd")})]}),(0,d.jsxs)("div",{className:"time-slider",children:[(0,d.jsx)("label",{children:"Set Time:"}),(0,d.jsx)("input",{type:"range",min:0,max:1435,step:5,value:($=p,60*$.getHours()+$.getMinutes()),onChange:e=>{const a=e.target.value,s=Math.floor(a/60),t=(0,o.g)((0,i.a)(p,s),a%60);b(t)}}),(0,d.jsx)("span",{children:(0,c.GP)(p,"HH:mm")})]})]}),(0,d.jsx)("div",{className:"floor-selector",children:null===a||void 0===a||null===(e=a.floors)||void 0===e?void 0:e.map((e=>(0,d.jsxs)("button",{onClick:()=>(e=>{const s=a.floors.find((a=>a.floorNumber===e));h(s)})(e.floorNumber),children:["Floor ",e.floorNumber]},e.floorNumber)))}),(0,d.jsx)("div",{className:"classrooms-list",children:m.map(((e,a)=>(0,d.jsxs)("div",{className:"classroom-container",children:[(0,d.jsxs)("div",{className:"classroom-header",children:[(0,d.jsx)("a",{href:`/classroom/${e.campusName||"MS"}/${e.number}/${e.roomId}`,className:"classroom-number",children:e.number}),(0,d.jsx)("span",{className:"status-circle "+("taken"===e.status?"taken":"canceled"===e.status?"canceled":"empty")})]}),(0,d.jsx)("div",{className:"classroom-details",children:"taken"===e.status?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{href:`/teacher/${e.teacherName}/${e.teacherTitle}/${e.teacherId}`,className:"teacher-name",children:e.teacherName||"No teacher"}),(0,d.jsx)("div",{className:"class-title",children:e.classTitle||"No subject"})]}):"canceled"===e.status?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("a",{href:`/teacher/${e.teacherName}/${e.teacherTitle}/${e.teacherId}`,className:"teacher-name",children:e.teacherName||"No teacher"}),(0,d.jsx)("div",{className:"class-title",children:e.classTitle||"No subject"}),(0,d.jsx)("span",{className:"canceled-notice",children:e.canceledNotice})]}):(0,d.jsx)("span",{className:"classroom-number",children:"Empty"})}),(0,d.jsxs)("div",{className:"classroom-time",children:[e.recurrenceStartTime," - ",e.recurrenceEndTime]})]},a)))})]});var $};var h=s(475);const m=function(){const[e,a]=(0,t.useState)([]),[s,r]=(0,t.useState)(!1),[c,l]=(0,t.useState)(null);return(0,t.useEffect)((()=>{(async()=>{try{var e;const s=await fetch("https://backend-azure-sqlite-appservice.azurewebsites.net/Main/teacher/all");if(!s.ok||null!==(e=s.headers.get("content-type"))&&void 0!==e&&e.includes("text/html"))throw new Error("Failed to fetch teachers. Server might be redirecting or returning HTML.");const t=await s.json();a(t)}catch(s){console.error("Error fetching teachers:",s),l("Failed to load teacher data. Please try again later.")}})()}),[]),c?(0,d.jsx)("div",{className:"error-message",children:c}):(0,d.jsxs)("div",{className:"teacher-list-container",children:[(0,d.jsx)("button",{className:"toggle-button",onClick:()=>r((e=>!e)),children:s?"Hide Teacher List":"Show Teacher List"}),s&&(0,d.jsx)("div",{className:"teacher-list",children:0===e.length?(0,d.jsx)("div",{children:"Loading..."}):(0,d.jsx)("div",{className:"scrollable-teacher-list",children:e.map((e=>(0,d.jsx)("button",{className:"teacher-button",title:`${e.TeacherName} - ${e.TeacherTitle}`,children:(0,d.jsx)(h.N_,{to:`/teacher/${e.TeacherName}/${e.TeacherTitle}/${e.TeacherId}`,children:e.TeacherName})},e.TeacherId)))})})]})};const N=function(){return(0,d.jsx)("div",{className:"home-page",children:(0,d.jsxs)("div",{className:"content-container",children:[(0,d.jsx)(u,{}),(0,d.jsx)(m,{})]})})}}}]);
//# sourceMappingURL=688.9d04b067.chunk.js.map