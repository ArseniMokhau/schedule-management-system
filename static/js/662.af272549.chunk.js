"use strict";(self.webpackChunkschedule_management_system=self.webpackChunkschedule_management_system||[]).push([[662],{746:(e,s,a)=>{a.d(s,{A:()=>j});var r=a(43),t=a(475),c=a(620),n=a(849),A=a(316);function l(e,s){const a=(0,n.q)(),r=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,t=(0,A.a)(e,s?.in),c=t.getDay(),l=6+(c<r?-7:0)-(c-r);return t.setDate(t.getDate()+l),t.setHours(23,59,59,999),t}var o=a(653),i=a(563),d=a(981);function h(e,s,a){return(0,d.f)(e,7*s,a)}var u=a(865),m=a(799),y=a(107),k=a(498),g=a(579);const j=function(e){let{id:s,scheduleType:a,refreshTrigger:n,onClassCancelled:A}=e;const[d,j]=(0,r.useState)(!0),[p,w]=(0,r.useState)([]),{isLoggedIn:I,teacherId:T,token:M}=(0,y.J)(),[E,N]=(0,r.useState)(null),[C,f]=(0,r.useState)(new Date,"Europe/Warsaw"),x=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],D=(0,r.useCallback)((async()=>{let e;switch(a){case m.u.TEACHER:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/${s}/room/all`;break;case m.u.ROOM:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/classes/${s}/id`;break;default:throw new Error("Invalid schedule type")}try{j(!0);const s=await fetch(e);if(!s.ok)throw new Error(`Error fetching classes: ${s.statusText}`);const a=await s.json();w(a),N(null),j(!1)}catch(r){console.error("Error fetching classes:",r),N("Failed to load class data. Please try again later."),j(!1)}}),[s,a]);(0,r.useEffect)((()=>{D()}),[D,n]);const B=(()=>{const e=(0,c.k)(C,{weekStartsOn:1}),s=l(C,{weekStartsOn:1}),a=e=>"1.00:00:00"===e?"24:00:00":e,r=e=>(0,o.H)(`2000-01-01T${a(e)}`),t=(e=>{const s=new Date(2024,0,1),a=Math.floor((e-s)/864e5);return(Math.floor(a/7)+1)%2===0?"even":"odd"})(C),n=x.map((()=>[])),A=e=>0===e?6:e-1;return p.forEach((r=>{r.recurringClasses.forEach((c=>{const l=c.canceledDates.some((a=>{const r=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(a),t=(0,o.H)(r);return(0,i.v)(t,{start:e,end:s})}));(c.isEveryWeek||c.isEven&&"even"===t||!c.isEven&&"odd"===t)&&n[A(c.recurrenceDay)].push({...r,recurrenceStartTime:a(c.recurrenceStartTime),recurrenceEndTime:a(c.recurrenceEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isEveryWeek:c.isEveryWeek,isEven:c.isEven,isCanceled:l,recurrenceDay:c.recurrenceDay,classType:"Recurring"})})),r.oneTimeClasses&&r.oneTimeClasses.length>0&&r.oneTimeClasses.forEach((t=>{const c=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(t.oneTimeClassFullDate),l=(0,o.H)(c);if((0,i.v)(l,{start:e,end:s})){const e=A(l.getDay());n[e].push({...r,date:l,recurrenceStartTime:a(t.oneTimeClassStartTime),recurrenceEndTime:a(t.oneTimeClassEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isCanceled:r.isCanceled,classType:"One-Time"})}}))})),n.forEach((e=>{e.sort(((e,s)=>r(e.recurrenceStartTime)-r(s.recurrenceStartTime)))})),n})(),S=e=>f((s=>h(s,e))),b=async e=>{const{classId:s,classType:a,isCanceled:r,recurrenceDay:t}=e,c="https://backend-azure-sqlite-appservice.azurewebsites.net/Main";let n="",l=null;try{if("One-Time"===a)n=`${c}/cancelOrRestoreClassOneTime/${s}?teacherId=${T}&teacherToken=${M}`,l=null;else{if("Recurring"!==a)throw new Error("Unknown class type");{const e=(()=>{const e=new Date(C),s=e.getDay(),a=(0===t?7:t)-s;return e.setDate(e.getDate()+a),a<=0&&e.setDate(e.getDate()),e})();r?(n=`${c}/restoreRecurringClass/${s}?teacherId=${T}&teacherToken=${M}`,l=(0,u.GP)(e,"yyyy-MM-dd")):(n=`${c}/cancelRecurringClass/${s}?teacherId=${T}&teacherToken=${M}`,l=(0,u.GP)(e,"yyyy-MM-dd"))}}const e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:l?JSON.stringify(l):null});if(!e.ok)throw new Error(`Failed to update class: ${e.statusText}`);if(!(await e.json()).message.includes("successfully"))throw new Error("Unexpected response message");alert(`Class ${r?"restored":"canceled"} successfully.`),A()}catch(o){console.error("Error updating class:",o),alert("An error occurred while updating the class. Please try again."),A()}};return d?(0,g.jsx)(k.A,{}):(0,g.jsxs)("div",{className:"weekly-schedule-container",children:[E&&(0,g.jsx)("div",{className:"weekly-schedule-error-message",children:E}),(0,g.jsxs)("div",{className:"weekly-schedule-week-selector",children:[(0,g.jsx)("button",{className:"weekly-schedule-button",onClick:()=>S(-1),children:"Previous Week"}),(0,g.jsxs)("span",{className:"weekly-schedule-date-range",children:[(0,u.GP)((0,c.k)(C,{weekStartsOn:1}),"MMM d")," -"," ",(0,u.GP)(l(C,{weekStartsOn:1}),"MMM d")]}),(0,g.jsx)("button",{className:"weekly-schedule-button",onClick:()=>S(1),children:"Next Week"})]}),(0,g.jsx)("div",{className:"weekly-schedule-week",children:x.map(((e,s)=>(0,g.jsxs)("div",{className:"weekly-schedule-day-column",children:[(0,g.jsx)("h3",{className:"weekly-schedule-day-title",children:e}),B[s].length>0?B[s].map(((e,s)=>(0,g.jsxs)("div",{className:`weekly-schedule-class-card weekly-schedule-${e.classType.toLowerCase()}`,children:[(0,g.jsx)("h4",{className:"weekly-schedule-class-title",children:e.classTitle}),(0,g.jsx)(t.N_,{to:`/classroom/${e.campusName}/${e.roomNumber}/${e.roomId}`,className:"classroom-number",children:e.roomNumber}),(0,g.jsxs)("p",{className:"weekly-schedule-class-time",children:[(0,u.GP)((0,o.H)(`2000-01-01T${e.recurrenceStartTime}`),"HH:mm")," -"," ",(0,u.GP)((0,o.H)(`2000-01-01T${e.recurrenceEndTime}`),"HH:mm")]}),e.isCanceled&&(0,g.jsx)("span",{className:"",children:"Cancelled"}),(0,g.jsx)(t.N_,{to:`/teacher/${e.teacherName}/${e.teacherTitle}/${e.teacherId}`,className:"weekly-schedule-class-teacher",children:e.teacherName}),(0,g.jsxs)("div",{className:"class-card-buttons",children:[I&&T===e.teacherId&&(0,g.jsx)("button",{className:"cancel-meeting-button",onClick:()=>b(e),children:e.isCanceled?"Restore Meeting":"Cancel Meeting"}),I&&T===e.teacherId&&(0,g.jsx)("button",{className:"delete-meeting-button",onClick:()=>(async e=>{try{if(!T||!M)return void alert("Authentication details are missing. Please log in again.");const s=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/deleteClass/${e.classId}?teacherId=${T}&teacherToken=${M}`,a=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Unexpected server response");if("Class and all related data deleted successfully."!==(await a.json()).message)throw new Error("Unexpected server response");{const s=p.filter((s=>s.classId!==e.classId));w(s),alert(`Class ${e.classTitle} has been deleted successfully`)}}catch(s){console.error("Error deleting class:",s),alert("An error occurred while deleting the class. Please try again.")}})(e),children:"Delete Meeting"})]})]},s))):(0,g.jsx)("p",{className:"weekly-schedule-no-classes",children:"No classes"})]},s)))})]})}},799:(e,s,a)=>{a.d(s,{u:()=>r});const r={TEACHER:"TEACHER",ROOM:"ROOM"}},662:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var r=a(43),t=a(216),c=a(746),n=a(799);const A="data:image/jpeg;base64,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",l={Arseni:A,Default:A},o={"In\u017cynier":"In\u017c.",Doktor:"Dr.",Profesor:"Prof.",Magister:"Mgr."};var i=a(579);const d=function(){const{name:e,title:s,id:a}=(0,t.g)(),[A,d]=(0,r.useState)(!1),h=o[s]||s;return(0,i.jsxs)("div",{className:"teacher-page",children:[(0,i.jsxs)("div",{className:"teacher-info",children:[(0,i.jsx)("img",{src:l[e]||l.Default,alt:e,className:"teacher-photo"}),(0,i.jsx)("div",{className:"teacher-details",children:(0,i.jsxs)("h1",{children:[e," ",(0,i.jsx)("span",{className:"teacher-title",children:h})]})})]}),(0,i.jsxs)("div",{className:"schedule-section",children:[(0,i.jsx)("h1",{children:"Weekly Schedule"}),(0,i.jsx)(c.A,{id:a,scheduleType:n.u.TEACHER,refreshTrigger:A,onClassCancelled:()=>{d((e=>!e))}})]})]})}},981:(e,s,a)=>{a.d(s,{f:()=>c});var r=a(440),t=a(316);function c(e,s,a){const c=(0,t.a)(e,a?.in);return isNaN(s)?(0,r.w)(a?.in||e,NaN):s?(c.setDate(c.getDate()+s),c):c}}}]);
//# sourceMappingURL=662.af272549.chunk.js.map