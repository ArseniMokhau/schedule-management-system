"use strict";(self.webpackChunkschedule_management_system=self.webpackChunkschedule_management_system||[]).push([[662],{615:(e,s,a)=>{a.d(s,{A:()=>j});var r=a(43),t=a(620),c=a(849),A=a(316);function n(e,s){const a=(0,c.q)(),r=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,t=(0,A.a)(e,s?.in),n=t.getDay(),l=6+(n<r?-7:0)-(n-r);return t.setDate(t.getDate()+l),t.setHours(23,59,59,999),t}var l=a(653),o=a(563),i=a(440);function d(e,s,a){const r=(0,A.a)(e,a?.in);return isNaN(s)?(0,i.w)(a?.in||e,NaN):s?(r.setDate(r.getDate()+s),r):r}function h(e,s,a){return d(e,7*s,a)}var u=a(35),m=a(799),k=a(107),y=a(579);const j=function(e){let{id:s,scheduleType:a,refreshTrigger:c}=e;const[A,i]=(0,r.useState)([]),{isLoggedIn:d,teacherId:j,token:p}=(0,k.J)(),[g,I]=(0,r.useState)(null),[T,w]=(0,r.useState)(new Date,"Europe/Warsaw"),E=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],M=(0,r.useCallback)((async()=>{let e;switch(a){case m.u.TEACHER:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/${s}/room/all`;break;case m.u.ROOM:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/classes/${s}/id`;break;default:throw new Error("Invalid schedule type")}try{const s=await fetch(e);if(!s.ok)throw new Error(`Error fetching classes: ${s.statusText}`);const a=await s.json();i(a),I(null)}catch(r){console.error("Error fetching classes:",r),I("Failed to load class data. Please try again later.")}}),[s,a]);(0,r.useEffect)((()=>{M()}),[M,c]);const N=(()=>{const e=(0,t.k)(T,{weekStartsOn:1}),s=n(T,{weekStartsOn:1}),a=e=>"1.00:00:00"===e?"24:00:00":e,r=e=>(0,l.H)(`2000-01-01T${a(e)}`),c=(e=>{const s=new Date(2024,0,1),a=Math.floor((e-s)/864e5);return(Math.floor(a/7)+1)%2===0?"even":"odd"})(T),i=E.map((()=>[])),d=e=>0===e?6:e-1;return A.forEach((r=>{r.recurringClasses.forEach((t=>{const A=t.canceledDates.some((a=>{const r=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(a),t=(0,l.H)(r);return(0,o.v)(t,{start:e,end:s})}));(t.isEveryWeek||t.isEven&&"even"===c||!t.isEven&&"odd"===c)&&i[d(t.recurrenceDay)].push({...r,recurrenceStartTime:a(t.recurrenceStartTime),recurrenceEndTime:a(t.recurrenceEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isEveryWeek:t.isEveryWeek,isEven:t.isEven,isCanceled:A,recurrenceDay:t.recurrenceDay,classType:"Recurring"})})),r.oneTimeClasses&&r.oneTimeClasses.length>0&&r.oneTimeClasses.forEach((t=>{const c=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(t.oneTimeClassFullDate),A=(0,l.H)(c);if(console.log(c),console.log(A),(0,o.v)(A,{start:e,end:s})){const e=d(A.getDay());i[e].push({...r,date:A,recurrenceStartTime:a(t.oneTimeClassStartTime),recurrenceEndTime:a(t.oneTimeClassEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isCanceled:r.isCanceled,classType:"One-Time"})}}))})),i.forEach((e=>{e.sort(((e,s)=>r(e.recurrenceStartTime)-r(s.recurrenceStartTime)))})),console.log(A),console.log(i),i})(),C=e=>w((s=>h(s,e)));return(0,y.jsxs)("div",{className:"weekly-schedule-container",children:[g&&(0,y.jsx)("div",{className:"weekly-schedule-error-message",children:g}),(0,y.jsxs)("div",{className:"weekly-schedule-week-selector",children:[(0,y.jsx)("button",{className:"weekly-schedule-button",onClick:()=>C(-1),children:"Previous Week"}),(0,y.jsxs)("span",{className:"weekly-schedule-date-range",children:[(0,u.GP)((0,t.k)(T,{weekStartsOn:1}),"MMM d")," -"," ",(0,u.GP)(n(T,{weekStartsOn:1}),"MMM d")]}),(0,y.jsx)("button",{className:"weekly-schedule-button",onClick:()=>C(1),children:"Next Week"})]}),(0,y.jsx)("div",{className:"weekly-schedule-week",children:E.map(((e,s)=>(0,y.jsxs)("div",{className:"weekly-schedule-day-column",children:[(0,y.jsx)("h3",{className:"weekly-schedule-day-title",children:e}),N[s].length>0?N[s].map(((e,s)=>(0,y.jsxs)("div",{className:`weekly-schedule-class-card weekly-schedule-${e.classType.toLowerCase()}`,children:[(0,y.jsx)("h4",{className:"weekly-schedule-class-title",children:e.classTitle}),(0,y.jsx)("a",{href:`/classroom/${e.campusName}/${e.roomNumber}/${e.roomId}`,className:"classroom-number",children:e.roomNumber}),(0,y.jsxs)("p",{className:"weekly-schedule-class-time",children:[(0,u.GP)((0,l.H)(`2000-01-01T${e.recurrenceStartTime}`),"HH:mm")," -"," ",(0,u.GP)((0,l.H)(`2000-01-01T${e.recurrenceEndTime}`),"HH:mm")]}),e.isCanceled&&(0,y.jsx)("span",{className:"",children:"Cancelled"}),(0,y.jsxs)("a",{href:`/teacher/${e.teacherName}/${e.teacherTitle}/${e.teacherId}`,className:"weekly-schedule-class-teacher",children:[e.teacherTitle||"No title","   ",e.teacherName]}),(0,y.jsxs)("div",{className:"class-card-buttons",children:[d&&j===e.teacherId&&"One-Time"===e.classType&&(0,y.jsx)("button",{className:"cancel-meeting-button",onClick:()=>(async e=>{const{classId:s,classType:a,isCanceled:r}=e;let t="",c=null;try{"One-Time"===a&&(t=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/cancelOrRestoreClassOneTime/${s}?teacherId=${j}&teacherToken=${p}`,c=null);const e=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:c?JSON.stringify(c):null});if(!e.ok)throw new Error(`Failed to update class: ${e.statusText}`);if("successfully."!==(await e.json()).message)throw new Error("Unexpected response message");{const e=A.map((e=>e.classId===s?{...e,isCanceled:!r}:e));i(e),alert(`Class ${r?"restored":"canceled"} successfully.`)}}catch(n){console.error("Error updating class:",n),alert("An error occurred while updating the class. Please try again.")}})(e),children:e.isCanceled?"Restore Meeting":"Cancel Meeting"}),d&&j===e.teacherId&&(0,y.jsx)("button",{className:"delete-meeting-button",onClick:()=>(async e=>{try{if(!j||!p)return void alert("Authentication details are missing. Please log in again.");const s=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/deleteClass/${e.classId}?teacherId=${j}&teacherToken=${p}`,a=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Unexpected server response");if("Class and all related data deleted successfully."!==(await a.json()).message)throw new Error("Unexpected server response");{const s=A.filter((s=>s.classId!==e.classId));i(s),alert(`Class ${e.classTitle} has been deleted successfully`)}}catch(s){console.error("Error deleting class:",s),alert("An error occurred while deleting the class. Please try again.")}})(e),children:"Delete Meeting"})]})]},s))):(0,y.jsx)("p",{className:"weekly-schedule-no-classes",children:"No classes"})]},s)))})]})}},799:(e,s,a)=>{a.d(s,{u:()=>r});const r={TEACHER:"TEACHER",ROOM:"ROOM"}},662:(e,s,a)=>{a.r(s),a.d(s,{default:()=>i});a(43);var r=a(216),t=a(615),c=a(799);const A="data:image/jpeg;base64,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",n={Arseni:A,Default:A},l={"In\u017cynier":"In\u017c.",Doktor:"Dr.",Profesor:"Prof.",Magister:"Mgr."};var o=a(579);const i=function(){const{name:e,title:s,id:a}=(0,r.g)(),A=l[s]||s;return(0,o.jsxs)("div",{className:"teacher-page",children:[(0,o.jsxs)("div",{className:"teacher-info",children:[(0,o.jsx)("img",{src:n[e]||n.Default,alt:e,className:"teacher-photo"}),(0,o.jsx)("div",{className:"teacher-details",children:(0,o.jsxs)("h1",{children:[e," ",(0,o.jsx)("span",{className:"teacher-title",children:A})]})})]}),(0,o.jsxs)("div",{className:"schedule-section",children:[(0,o.jsx)("h1",{children:"Weekly Schedule"}),(0,o.jsx)(t.A,{id:a,scheduleType:c.u.TEACHER})]})]})}}}]);
//# sourceMappingURL=662.f3b79585.chunk.js.map