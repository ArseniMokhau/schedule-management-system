"use strict";(self.webpackChunkschedule_management_system=self.webpackChunkschedule_management_system||[]).push([[380],{615:(e,s,a)=>{a.d(s,{A:()=>k});var r=a(43),c=a(475),t=a(620),l=a(849),n=a(316);function o(e,s){const a=(0,l.q)(),r=s?.weekStartsOn??s?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,c=(0,n.a)(e,s?.in),t=c.getDay(),o=6+(t<r?-7:0)-(t-r);return c.setDate(c.getDate()+o),c.setHours(23,59,59,999),c}var i=a(653),d=a(563),m=a(440);function h(e,s,a){const r=(0,n.a)(e,a?.in);return isNaN(s)?(0,m.w)(a?.in||e,NaN):s?(r.setDate(r.getDate()+s),r):r}function u(e,s,a){return h(e,7*s,a)}var p=a(35),g=a(799),w=a(107),y=a(579);const k=function(e){let{id:s,scheduleType:a,refreshTrigger:l}=e;const[n,m]=(0,r.useState)([]),{isLoggedIn:h,teacherId:k,token:N}=(0,w.J)(),[T,f]=(0,r.useState)(null),[x,j]=(0,r.useState)(new Date,"Europe/Warsaw"),b=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],C=(0,r.useCallback)((async()=>{let e;switch(a){case g.u.TEACHER:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/${s}/room/all`;break;case g.u.ROOM:e=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/classes/${s}/id`;break;default:throw new Error("Invalid schedule type")}try{const s=await fetch(e);if(!s.ok)throw new Error(`Error fetching classes: ${s.statusText}`);const a=await s.json();m(a),f(null)}catch(r){console.error("Error fetching classes:",r),f("Failed to load class data. Please try again later.")}}),[s,a]);(0,r.useEffect)((()=>{C()}),[C,l]);const v=(()=>{const e=(0,t.k)(x,{weekStartsOn:1}),s=o(x,{weekStartsOn:1}),a=e=>"1.00:00:00"===e?"24:00:00":e,r=e=>(0,i.H)(`2000-01-01T${a(e)}`),c=(e=>{const s=new Date(2024,0,1),a=Math.floor((e-s)/864e5);return(Math.floor(a/7)+1)%2===0?"even":"odd"})(x),l=b.map((()=>[])),m=e=>0===e?6:e-1;return n.forEach((r=>{r.recurringClasses.forEach((t=>{const n=t.canceledDates.some((a=>{const r=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(a),c=(0,i.H)(r);return(0,d.v)(c,{start:e,end:s})}));(t.isEveryWeek||t.isEven&&"even"===c||!t.isEven&&"odd"===c)&&l[m(t.recurrenceDay)].push({...r,recurrenceStartTime:a(t.recurrenceStartTime),recurrenceEndTime:a(t.recurrenceEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isEveryWeek:t.isEveryWeek,isEven:t.isEven,isCanceled:n,recurrenceDay:t.recurrenceDay,classType:"Recurring"})})),r.oneTimeClasses&&r.oneTimeClasses.length>0&&r.oneTimeClasses.forEach((c=>{const t=(e=>{const[s,a,r]=e.split("/");return new Date(`${r}-${s}-${a}`).toISOString()})(c.oneTimeClassFullDate),n=(0,i.H)(t);if(console.log(t),console.log(n),(0,d.v)(n,{start:e,end:s})){const e=m(n.getDay());l[e].push({...r,date:n,recurrenceStartTime:a(c.oneTimeClassStartTime),recurrenceEndTime:a(c.oneTimeClassEndTime),teacherId:r.teacherId,teacherName:r.teacherName,teacherTitle:r.teacherTitle,roomNumber:r.roomNumber,roomId:r.roomId,isCanceled:r.isCanceled,classType:"One-Time"})}}))})),l.forEach((e=>{e.sort(((e,s)=>r(e.recurrenceStartTime)-r(s.recurrenceStartTime)))})),console.log(n),console.log(l),l})(),E=e=>j((s=>u(s,e)));return(0,y.jsxs)("div",{className:"weekly-schedule-container",children:[T&&(0,y.jsx)("div",{className:"weekly-schedule-error-message",children:T}),(0,y.jsxs)("div",{className:"weekly-schedule-week-selector",children:[(0,y.jsx)("button",{className:"weekly-schedule-button",onClick:()=>E(-1),children:"Previous Week"}),(0,y.jsxs)("span",{className:"weekly-schedule-date-range",children:[(0,p.GP)((0,t.k)(x,{weekStartsOn:1}),"MMM d")," -"," ",(0,p.GP)(o(x,{weekStartsOn:1}),"MMM d")]}),(0,y.jsx)("button",{className:"weekly-schedule-button",onClick:()=>E(1),children:"Next Week"})]}),(0,y.jsx)("div",{className:"weekly-schedule-week",children:b.map(((e,s)=>(0,y.jsxs)("div",{className:"weekly-schedule-day-column",children:[(0,y.jsx)("h3",{className:"weekly-schedule-day-title",children:e}),v[s].length>0?v[s].map(((e,s)=>(0,y.jsxs)("div",{className:`weekly-schedule-class-card weekly-schedule-${e.classType.toLowerCase()}`,children:[(0,y.jsx)("h4",{className:"weekly-schedule-class-title",children:e.classTitle}),(0,y.jsx)(c.N_,{to:`/classroom/${e.campusName}/${e.roomNumber}/${e.roomId}`,className:"classroom-number",children:e.roomNumber}),(0,y.jsxs)("p",{className:"weekly-schedule-class-time",children:[(0,p.GP)((0,i.H)(`2000-01-01T${e.recurrenceStartTime}`),"HH:mm")," -"," ",(0,p.GP)((0,i.H)(`2000-01-01T${e.recurrenceEndTime}`),"HH:mm")]}),e.isCanceled&&(0,y.jsx)("span",{className:"",children:"Cancelled"}),(0,y.jsx)(c.N_,{to:`/teacher/${e.teacherName}/${e.teacherTitle}/${e.teacherId}`,className:"weekly-schedule-class-teacher",children:e.teacherName}),(0,y.jsxs)("div",{className:"class-card-buttons",children:[h&&k===e.teacherId&&"One-Time"===e.classType&&(0,y.jsx)("button",{className:"cancel-meeting-button",onClick:()=>(async e=>{const{classId:s,classType:a,isCanceled:r}=e;let c="",t=null;try{"One-Time"===a&&(c=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/cancelOrRestoreClassOneTime/${s}?teacherId=${k}&teacherToken=${N}`,t=null);const e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):null});if(!e.ok)throw new Error(`Failed to update class: ${e.statusText}`);if("successfully."!==(await e.json()).message)throw new Error("Unexpected response message");{const e=n.map((e=>e.classId===s?{...e,isCanceled:!r}:e));m(e),alert(`Class ${r?"restored":"canceled"} successfully.`)}}catch(l){console.error("Error updating class:",l),alert("An error occurred while updating the class. Please try again.")}})(e),children:e.isCanceled?"Restore Meeting":"Cancel Meeting"}),h&&k===e.teacherId&&(0,y.jsx)("button",{className:"delete-meeting-button",onClick:()=>(async e=>{try{if(!k||!N)return void alert("Authentication details are missing. Please log in again.");const s=`https://backend-azure-sqlite-appservice.azurewebsites.net/Main/deleteClass/${e.classId}?teacherId=${k}&teacherToken=${N}`,a=await fetch(s,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error("Unexpected server response");if("Class and all related data deleted successfully."!==(await a.json()).message)throw new Error("Unexpected server response");{const s=n.filter((s=>s.classId!==e.classId));m(s),alert(`Class ${e.classTitle} has been deleted successfully`)}}catch(s){console.error("Error deleting class:",s),alert("An error occurred while deleting the class. Please try again.")}})(e),children:"Delete Meeting"})]})]},s))):(0,y.jsx)("p",{className:"weekly-schedule-no-classes",children:"No classes"})]},s)))})]})}},799:(e,s,a)=>{a.d(s,{u:()=>r});const r={TEACHER:"TEACHER",ROOM:"ROOM"}},622:(e,s,a)=>{a.r(s),a.d(s,{default:()=>o});a(43);var r=a(216),c=a(615),t=a(799);const l={MS:{fullName:"Wydzia\u0142 Matematyki Stosowanej",mapsEmbedSrc:"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2549.043926603353!2d18.677463113142103!3d50.29110789870408!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47113101aa29eacb%3A0xb264c95270614eda!2sPolitechnika%20%C5%9Al%C4%85ska%2C%20Wydzia%C5%82%20Matematyki%20Stosowanej!5e0!3m2!1sen!2spl!4v1733085254800!5m2!1sen!2spl",imageSrc:a.p+"static/media/wydzial-rms-slide.f401748cc346648833d1.jpg"}};var n=a(579);const o=function(){const{campus:e,number:s,id:o}=(0,r.g)(),i=l[e];return(0,n.jsxs)("div",{className:"classroom-page-container",children:[(0,n.jsxs)("div",{className:"classroom-page-header",children:[(0,n.jsx)("h2",{className:"classroom-page-title",children:i.fullName}),(0,n.jsx)("div",{className:"classroom-page-info",children:(0,n.jsx)("h1",{className:"classroom-page-classroom-number",children:s})})]}),(0,n.jsxs)("div",{className:"classroom-page-schedule-section",children:[(0,n.jsx)("h2",{className:"classroom-page-schedule-title",children:"Classroom Weekly Schedule"}),(0,n.jsx)(c.A,{id:o,scheduleType:t.u.ROOM})]}),(0,n.jsxs)("div",{className:"classroom-page-campus-info-section",children:[(0,n.jsxs)("div",{className:"classroom-page-google-maps",children:[(0,n.jsx)("h3",{className:"classroom-page-google-maps-title",children:"Campus Location"}),(0,n.jsx)("iframe",{src:i.mapsEmbedSrc,width:"600",height:"450",style:{border:"0"},allowFullScreen:"",loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:`Google Maps embed showing the location of ${e}`})]}),(0,n.jsxs)("div",{className:"classroom-page-campus-image",children:[(0,n.jsx)("h3",{className:"classroom-page-campus-image-title",children:"Campus Image"}),(0,n.jsx)("img",{src:i.imageSrc,alt:`${e} campus`})]})]}),(0,n.jsxs)("div",{className:"classroom-page-maphelper-section",children:[(0,n.jsx)("h3",{className:"classroom-page-maphelper-title",children:"Get MapHelper App"}),(0,n.jsx)("a",{href:"https://arsenimokhau.github.io/Map-Helper/",target:"_blank",rel:"noopener noreferrer",children:(0,n.jsx)("img",{src:a(402),alt:"QR Code for MapHelper",className:"classroom-page-maphelper-qr",style:{width:"200px",height:"200px"}})}),(0,n.jsx)("p",{children:"Scan the QR code or click it to open the MapHelper application."})]})]})}},402:(e,s,a)=>{e.exports=a.p+"static/media/qr.a3e5c59d148691b73a45.png"}}]);
//# sourceMappingURL=380.e53594af.chunk.js.map